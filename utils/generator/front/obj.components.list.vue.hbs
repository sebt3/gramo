<script setup lang="ts">
import TableHeader from '@/components/core/TableHeader.vue';
import { ref, use{{ short }}, {{ short }}Columns{{#if namespaced}}, {{ short }}AllColumns{{/if}} } from '../../libs/{{ group }}/{{ short }}.js'
const { actionNew, toEdit, toParentView, pagination{{#if namespaced}}, navigation, isNamespaced{{/if}} } = use{{ short }}();
import { color{{ short }}, icon{{ short }} } from '../../libs/{{ group }}/custom.js'
let filter = ref('');
defineEmits(['refresh','on-delete']);
withDefaults(defineProps<{model: object[], useAction?:boolean, useRefresh?: boolean}>(),{
  useAction: false,
  useRefresh: true
});
</script>
<template>
  <q-card class="q-ma-sm" bordered>
    <TableHeader title="{{ short }}" :icon="icon{{ short }}" :class="`bg-${ color{{ short }} }`" :usecreate="useAction" :userefresh="useRefresh" itemtype='{{ group }} {{ short }}' v-model:model-filter="filter" @refresh="$emit('refresh')" @create="actionNew({{#if namespaced}}navigation.currentNamespace.value{{/if}})" />
    <q-card-section class="q-pa-none">
    <q-table :rows="model" :class="`bg-${ color{{ short }} }-1`" :columns="{{#if namespaced}}!isNamespaced()?{{ short }}AllColumns:{{/if}}{{ short }}Columns.filter(c=>c.name!='Action'||useAction)" class="no-shadow" v-model:pagination="pagination" :filter="filter" hide-bottom>
{{#if namespaced}}
        <template v-slot:body-cell-Namespace="props" v-if="!isNamespaced()">
          <q-td :props="props">
            <router-link :to="{ name: '{{ group }}{{ short }}Table', params: { namespace: props.row.metadata.namespace }}">\{{ props.row.metadata.namespace }}</router-link>
          </q-td>
        </template>
{{/if}}
        <template v-slot:body-cell-Name="props">
          <q-td :props="props">
            <router-link :to="{ name: '{{ group }}{{ short }}View', params: { {{#if namespaced}}namespace: props.row.metadata.namespace, {{/if}}name: props.row.metadata.name }}">\{{ props.row.metadata.name }}</router-link>
          </q-td>
        </template>
        <template v-slot:body-cell-Action="props" v-if="useAction">
          <q-td :props="props">
            <q-btn icon="edit" size="sm" class="q-ml-sm" flat dense
              @click="toEdit({{#if namespaced}}props.row.metadata.namespace, {{/if}}props.row.metadata.name)"
              v-if="props.row.parentReference==null">
              <q-tooltip>Edit {{ short }} \{{ props.row.metadata.name }}</q-tooltip>
            </q-btn>
            <q-btn icon="delete" size="sm" class="q-ml-sm" flat dense
              @click="$emit('on-delete', props.row.metadata)"
              v-if="props.row.parentReference==null">
              <q-tooltip>Delete {{ short }} \{{ props.row.metadata.name }}</q-tooltip>
            </q-btn>
            <q-btn icon="arrow_upward" size="sm" class="q-ml-sm" flat dense
              @click="toParentView(props.row.parentReference.group, props.row.parentReference.short, props.row.parentReference.name, props.row.parentReference.namespace)"
              v-if="props.row.parentReference!=null">
              <q-tooltip>View parent \{{ props.row.parentReference.short }} \{{ props.row.parentReference.name }}</q-tooltip>
            </q-btn>
          </q-td>
        </template>
      </q-table>
    </q-card-section>
  </q-card>
</template>
